<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>تطبيق القرآن – قراءة تلقائية</title>
<style>
body{margin:0;font-family:"Segoe UI","Noto Naskh Arabic",Tahoma,sans-serif;background:#f7f7f7;color:#222;display:flex;flex-direction:column;min-height:100vh;}
header{padding:14px;background:#0b5bd7;color:#fff;display:flex;align-items:center;justify-content:space-between;}
header h1{margin:0;font-size:18px;}
main{flex:1;display:flex;gap:16px;padding:16px;flex-wrap:wrap;}
.sidebar{width:280px;background:#fff;padding:12px;border-radius:10px;overflow:auto;max-height:calc(100vh - 100px);}
.content{flex:1;background:#fff;padding:12px;border-radius:10px;overflow:auto;max-height:calc(100vh - 100px);}
ul.surah-list{list-style:none;padding:0;margin:0;}
li.surah{padding:8px;border-radius:6px;margin-bottom:6px;cursor:pointer;border:1px solid #ddd;}
li.surah:hover{background:#0b5bd7;color:#fff;}
li.surah.active{background:#0b5bd7;color:#fff;}
.aya-text{font-size:28px;line-height:1.6;text-align:right;font-weight:600;margin-bottom:12px;}
button{padding:8px 10px;border:none;border-radius:8px;cursor:pointer;background:#0b5bd7;color:#fff;margin-right:6px;}
button:disabled{opacity:0.5;cursor:default;}
</style>
</head>
<body>
<header>
<h1>تطبيق القرآن – قراءة تلقائية</h1>
<div>
<button id="playPauseBtn">تشغيل/إيقاف</button>
</div>
</header>

<main>
<aside class="sidebar">
<h3>السور</h3>
<ul id="surahList"></ul>
</aside>

<section class="content">
<h2 id="surahName">اختر سورة</h2>
<div id="ayaText" class="aya-text">النص سيظهر هنا أثناء التشغيل</div>
<audio id="audioPlayer" controls></audio>
</section>
</main>

<script>
const surahListEl = document.getElementById('surahList');
const surahNameEl = document.getElementById('surahName');
const ayaTextEl = document.getElementById('ayaText');
const audioPlayer = document.getElementById('audioPlayer');
const playPauseBtn = document.getElementById('playPauseBtn');

let state = {
  surahData: [],
  currentSurahIndex: null,
  currentAyaIndex: 0,
  ayaAudioList: [],
  isPlaying: false
};

// جلب قائمة السور
async function fetchSurahs(){
  try{
    const res = await fetch('https://api.alquran.cloud/v1/surah');
    const data = await res.json();
    state.surahData = data.data;
    renderSurahList();
  }catch(err){console.error('فشل تحميل السور',err);}
}

function renderSurahList(){
  surahListEl.innerHTML='';
  state.surahData.forEach((s,idx)=>{
    const li = document.createElement('li');
    li.className='surah';
    li.textContent = `${s.number}. ${s.name} (${s.numberOfAyahs} آية)`;
    li.addEventListener('click',()=>selectSurah(idx));
    surahListEl.appendChild(li);
  });
}

async function selectSurah(idx){
  // تفعيل تمييز السورة المختارة
  document.querySelectorAll('li.surah').forEach(li=>li.classList.remove('active'));
  document.querySelectorAll('li.surah')[idx].classList.add('active');

  state.currentSurahIndex = idx;
  state.currentAyaIndex = 0;
  surahNameEl.textContent = state.surahData[idx].name;

  // جلب كل روابط صوت الآيات للسورة
  const surahNumber = state.surahData[idx].number;
  const ayahCount = state.surahData[idx].numberOfAyahs;
  state.ayaAudioList = [];
  for(let i=1;i<=ayahCount;i++){
    const res = await fetch(`https://api.alquran.cloud/v1/ayah/${surahNumber}:${i}/ar.alafasy`);
    const data = await res.json();
    state.ayaAudioList.push({text:data.data.text,audio:data.data.audio});
  }

  playAyah(0);
}

// تشغيل آية معينة
function playAyah(index){
  if(!state.ayaAudioList[index]) return;
  state.currentAyaIndex = index;
  ayaTextEl.textContent = state.ayaAudioList[index].text;
  audioPlayer.src = state.ayaAudioList[index].audio;
  if(state.isPlaying) audioPlayer.play();
}

// عند انتهاء كل آية، الانتقال للتالية تلقائياً
audioPlayer.addEventListener('ended', ()=>{
  if(state.currentAyaIndex + 1 < state.ayaAudioList.length){
    playAyah(state.currentAyaIndex + 1);
  }else{
    state.isPlaying = false;
  }
});

// زر التشغيل/الإيقاف
playPauseBtn.addEventListener('click', ()=>{
  if(!state.ayaAudioList.length) return alert('اختر سورة أولاً');
  state.isPlaying = !state.isPlaying;
  if(state.isPlaying) audioPlayer.play();
  else audioPlayer.pause();
});

fetchSurahs();
</script>
</body>
</html>
